<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arb Panel</title>
    <link rel="stylesheet" href="/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <header>
      <h1>跨所价差监控</h1>
      <div class="toolbar">
        <div class="filters">
          <input type="text" id="q" placeholder="过滤交易对..." />
          <label>enterZ <input type="number" id="enterZ" step="0.1" value="2.0"/></label>
          <label>exitZ <input type="number" id="exitZ" step="0.1" value="0.5"/></label>
        </div>
        <button id="refresh">刷新</button>
        <span id="status">Loading...</span>
      </div>
    </header>

    <main>
      <table id="pairs-table">
        <thead>
          <tr>
            <th data-sort="pair">交易对</th>
            <th data-sort="price_a">A价格</th>
            <th data-sort="price_b">B价格</th>
            <th data-sort="spread">价差</th>
            <th data-sort="z">Z</th>
            <th data-sort="ema">EMA</th>
            <th data-sort="center_dev">中心偏离</th>
            <th data-sort="ob_spread_a">A点差</th>
            <th data-sort="ob_spread_b">B点差</th>
            <th data-sort="ob_spread_pct_a">A点差%</th>
            <th data-sort="ob_spread_pct_b">B点差%</th>
            <th data-sort="vol_a">A成交量(Q)</th>
            <th data-sort="vol_b">B成交量(Q)</th>
            <th data-sort="depth_qty_a">A厚度(Qty)</th>
            <th data-sort="depth_qty_b">B厚度(Qty)</th>
            <th data-sort="maker_fee_a">A费用</th>
            <th data-sort="maker_fee_b">B费用</th>
            <th data-sort="fr_a">A资金费率</th>
            <th data-sort="fr_b">B资金费率</th>
            <th data-sort="fr_countdown_ms">距下次资金</th>
            <th data-sort="t_exit_s">收敛预计</th>
            <th data-sort="skew_ms">时间偏差</th>
            <th data-sort="latency_ms">采样耗时</th>
          </tr>
        </thead>
        <tbody id="pairs-body"></tbody>
      </table>
    </main>

    <template id="detail-template">
      <tr class="detail-row">
        <td colspan="17">
          <div class="details">
            <div class="chart-container">
              <canvas class="chart" height="140"></canvas>
            </div>
            <div class="orderwalls">
              <div class="ow-col">
                <h4>A 订单墙</h4>
                <canvas class="ow-a" height="160"></canvas>
              </div>
              <div class="ow-col">
                <h4>B 订单墙</h4>
                <canvas class="ow-b" height="160"></canvas>
              </div>
            </div>
            <div class="meta">
              <div class="meta-col">
                <h4>说明</h4>
                <p>展开以查看历史价差/指标折线图。未来将加入订单墙可视化。</p>
              </div>
              <div class="meta-col">
                <h4>最近数据</h4>
                <pre class="last-json"></pre>
              </div>
              <div class="meta-col">
                <h4>建议</h4>
                <div class="advice"></div>
              </div>
              <div class="meta-col">
                <h4>模拟成本</h4>
                <div class="sim">
                  <label>名义(USD) <input type="number" class="sim-notional" value="1000"/></label>
                  <div class="btns">
                    <button class="sim-a-short-b-long">A空B多</button>
                    <button class="sim-a-long-b-short">A多B空</button>
                  </div>
                  <pre class="sim-out"></pre>
                </div>
              </div>
              <div class="meta-col">
                <h4>统计分析</h4>
                <div class="stats">
                  <div class="row">
                    <label>天数 <input type="number" class="st-days" value="7"/></label>
                    <label>exitZ <input type="number" step="0.1" class="st-exit" value="0.5"/></label>
                    <label>分箱 <input type="text" class="st-edges" value="1.5,2,2.5,3"/></label>
                    <button class="st-refresh">刷新统计</button>
                  </div>
                  <table class="st-table">
                    <thead>
                      <tr>
                        <th>|Z|分箱</th>
                        <th>样本</th>
                        <th>P25(s)</th>
                        <th>P50(s)</th>
                        <th>P75(s)</th>
                        <th>P90(s)</th>
                        <th>资金前收敛概率</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </template>

    <script src="/app.js"></script>
  </body>
  </html>
